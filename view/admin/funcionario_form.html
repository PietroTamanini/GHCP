{% extends "admin/base.html" %}

{% block title %}{% if funcionario %}Editar FuncionÃ¡rio{% else %}Novo FuncionÃ¡rio{% endif %}{% endblock %}
{% block page_title %}{% if funcionario %}âœï¸ Editar FuncionÃ¡rio{% else %}â• Novo FuncionÃ¡rio{% endif %}{% endblock %}

{% block content %}
<div class="form-container">
    <form method="POST" novalidate>
        <div class="form-grid">
            <div class="form-group full-width">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">ğŸ‘¤ InformaÃ§Ãµes do FuncionÃ¡rio</h3>
            </div>

            <div class="form-group full-width">
                <label for="nome">ğŸ“› Nome Completo *</label>
                <input type="text" id="nome" name="nome" class="form-control"
                       value="{{ funcionario.nome if funcionario else '' }}"
                       required maxlength="100" placeholder="Digite o nome completo">
            </div>

            <div class="form-group">
                <label for="email">ğŸ“§ E-mail *</label>
                <input type="email" id="email" name="email" class="form-control"
                       value="{{ funcionario.email if funcionario else '' }}"
                       required maxlength="100" placeholder="email@exemplo.com">
            </div>

            <div class="form-group">
                <label for="cargo">ğŸ’¼ Cargo *</label>
                <select id="cargo" name="cargo" class="form-control" required>
                    <option value="vendedor" {% if funcionario and funcionario.cargo == 'vendedor' %}selected{% endif %}>ğŸ›ï¸ Vendedor</option>
                    <option value="suporte" {% if funcionario and funcionario.cargo == 'suporte' %}selected{% endif %}>ğŸ”§ Suporte</option>
                    <option value="gerente" {% if funcionario and funcionario.cargo == 'gerente' %}selected{% endif %}>ğŸ‘” Gerente</option>
                    <option value="admin" {% if funcionario and funcionario.cargo == 'admin' %}selected{% endif %}>ğŸ‘‘ Administrador</option>
                </select>
            </div>

            {% if funcionario %}
            <div class="form-group">
                <label for="nova_senha">ğŸ”‘ Nova Senha (opcional)</label>
                <input type="password" id="nova_senha" name="nova_senha" class="form-control"
                       minlength="6" placeholder="Deixe em branco para manter a senha atual">
                <p style="margin-top: 0.5rem; opacity: 0.7; font-size: 0.9rem;">
                    ğŸ“ MÃ­nimo 6 caracteres. Deixe em branco se nÃ£o quiser alterar.
                </p>
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" name="ativo" {{ 'checked' if funcionario.ativo }}>
                    âœ… Conta Ativa
                </label>
                <p style="margin-top: 0.5rem; opacity: 0.7; font-size: 0.9rem;">
                    ğŸ“ Desmarque para desativar o acesso deste funcionÃ¡rio
                </p>
            </div>
            {% else %}
            <div class="form-group">
                <label for="senha">ğŸ”‘ Senha *</label>
                <input type="password" id="senha" name="senha" class="form-control"
                       required minlength="6" placeholder="MÃ­nimo 6 caracteres">
            </div>

            <div class="form-group">
                <label for="confirmar_senha">ğŸ” Confirmar Senha *</label>
                <input type="password" id="confirmar_senha" name="confirmar_senha" class="form-control"
                       required minlength="6" placeholder="Digite a senha novamente">
            </div>
            {% endif %}

            <div class="form-group full-width">
                <h3 style="margin-bottom: 1rem; color: var(--primary);">ğŸ” PermissÃµes por Cargo</h3>
                <div class="permissions-grid">
                    <div class="permission-item">
                        <strong>ğŸ‘‘ Administrador:</strong> Acesso total, incluindo gerenciar funcionÃ¡rios
                    </div>
                    <div class="permission-item">
                        <strong>ğŸ‘” Gerente:</strong> GestÃ£o de produtos, clientes, pedidos e diagnÃ³sticos
                    </div>
                    <div class="permission-item">
                        <strong>ğŸ›ï¸ Vendedor:</strong> VisualizaÃ§Ã£o de relatÃ³rios e estatÃ­sticas
                    </div>
                    <div class="permission-item">
                        <strong>ğŸ”§ Suporte:</strong> Apenas mÃ³dulo de diagnÃ³sticos tÃ©cnicos
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <a href="{{ url_for('admin_funcionarios') }}" class="btn btn-warning">
                â†©ï¸ Cancelar
            </a>
            <button type="submit" class="btn btn-primary">
                ğŸ’¾ {{ 'Atualizar' if funcionario else 'Cadastrar' }} FuncionÃ¡rio
            </button>
        </div>
    </form>
</div>

<style>
.form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.full-width {
    grid-column: 1 / -1;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text);
}

.form-control {
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
    background: var(--bg-color);
    color: var(--text);
}

.form-control:focus {
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 0 2px rgba(138, 43, 226, 0.1);
}

.permissions-grid {
    display: grid;
    gap: 12px;
    padding: 20px;
    background: rgba(70, 136, 235, 0.096);
    border-radius: 8px;
    border-left: 4px solid var(--primary);
}

.permission-item {
    padding: 8px 0;
    color: var(--text);
}

.form-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    padding-top: 20px;
    border-top: 1px solid #eee;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
}

.btn-warning {
    background: #6c757d;
    color: white;
}

.btn-warning:hover {
    background: #5a6268;
    transform: translateY(-1px);
}

/* Dark theme adjustments */
.dark-theme .form-control {
    background: rgba(255, 255, 255, 0.05);
    border-color: #444;
    color: var(--text);
}

.dark-theme .permissions-grid {
    background: rgba(138, 43, 226, 0.1);
}

.dark-theme .form-actions {
    border-top-color: #444;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>

{% if not funcionario %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const senha = document.getElementById('senha');
    const confirmarSenha = document.getElementById('confirmar_senha');

    form.addEventListener('submit', function(e) {
        if (senha && confirmarSenha && senha.value !== confirmarSenha.value) {
            e.preventDefault();
            alert('âŒ As senhas nÃ£o coincidem!');
            confirmarSenha.focus();
            confirmarSenha.style.borderColor = 'var(--danger)';
        }
    });

    if (confirmarSenha) {
        confirmarSenha.addEventListener('input', function() {
            if (this.style.borderColor) {
                this.style.borderColor = '';
            }
        });
    }
});
</script>
{% endif %}
{% endblock %}