{% extends "admin/base.html" %}

{% block title %}Diagn√≥stico #{{ diagnostico.id_diagnostico }}{% endblock %}
{% block page_title %}üîß Detalhes do Diagn√≥stico #{{ diagnostico.id_diagnostico }}{% endblock %}

{% block content %}
<div style="display: grid; gap: 2rem;">
    <!-- Formul√°rio de Atualiza√ß√£o -->
    <div class="form-container">
        <form method="POST">
            <div class="form-grid">
                <div class="form-group full-width">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">üìã Informa√ß√µes do Cliente</h3>
                </div>

                <div class="form-group">
                    <label>Nome do Cliente</label>
                    <div class="form-control" style="background: var(--secondary);">
                        {{ diagnostico.nome_cliente }}
                    </div>
                </div>

                <div class="form-group">
                    <label>E-mail</label>
                    <div class="form-control" style="background: var(--secondary);">
                        {{ diagnostico.email }}
                    </div>
                </div>

                <div class="form-group">
                    <label>Telefone</label>
                    <div class="form-control" style="background: var(--secondary);">
                        {{ diagnostico.telefone or 'N√£o informado' }}
                    </div>
                </div>

                <div class="form-group">
                    <label>Data de Entrada</label>
                    <div class="form-control" style="background: var(--secondary);">
                        {{ diagnostico.data_entrada.strftime('%d/%m/%Y √†s %H:%M') }}
                    </div>
                </div>

                <div class="form-group full-width">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">üíª Informa√ß√µes do Equipamento</h3>
                </div>

                <div class="form-group">
                    <label>Tipo de Equipamento</label>
                    <div class="form-control" style="background: var(--secondary);">
                        {{ diagnostico.tipo_equipamento }}
                    </div>
                </div>

                <div class="form-group">
                    <label>Marca</label>
                    <div class="form-control" style="background: var(--secondary);">
                        {{ diagnostico.marca or 'N√£o informada' }}
                    </div>
                </div>

                <div class="form-group">
                    <label>Modelo</label>
                    <div class="form-control" style="background: var(--secondary);">
                        {{ diagnostico.modelo or 'N√£o informado' }}
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="problema">üîß Problema Relatado</label>
                    <div class="form-control" style="background: var(--secondary); min-height: 80px;">
                        {{ diagnostico.problema }}
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="sintomas">üìù Sintomas Relatados</label>
                    <div class="form-control" style="background: var(--secondary); min-height: 80px;">
                        {{ diagnostico.sintomas or 'Nenhum sintoma adicional relatado' }}
                    </div>
                </div>

                <div class="form-group full-width">
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">‚öôÔ∏è An√°lise T√©cnica</h3>
                </div>

                <div class="form-group">
                    <label for="status">üìä Status do Diagn√≥stico *</label>
                    <select id="status" name="status" class="form-control" required>
                        <option value="recebido" {% if diagnostico.status == 'recebido' %}selected{% endif %}>Recebido</option>
                        <option value="em_analise" {% if diagnostico.status == 'em_analise' %}selected{% endif %}>Em An√°lise</option>
                        <option value="diagnosticado" {% if diagnostico.status == 'diagnosticado' %}selected{% endif %}>Diagnosticado</option>
                        <option value="orcamento" {% if diagnostico.status == 'orcamento' %}selected{% endif %}>Or√ßamento</option>
                        <option value="aprovado" {% if diagnostico.status == 'aprovado' %}selected{% endif %}>Aprovado</option>
                        <option value="reparacao" {% if diagnostico.status == 'reparacao' %}selected{% endif %}>Repara√ß√£o</option>
                        <option value="concluido" {% if diagnostico.status == 'concluido' %}selected{% endif %}>Conclu√≠do</option>
                        <option value="entregue" {% if diagnostico.status == 'entregue' %}selected{% endif %}>Entregue</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="orcamento">üí∞ Or√ßamento (R$)</label>
                    <input type="number" id="orcamento" name="orcamento" class="form-control" 
                           step="0.01" min="0" value="{{ "%.2f"|format(diagnostico.orcamento) if diagnostico.orcamento }}">
                </div>

                <div class="form-group full-width">
                    <label for="pecas_defeito">üî© Pe√ßas com Defeito</label>
                    <textarea id="pecas_defeito" name="pecas_defeito" class="form-control" 
                              placeholder="Liste as pe√ßas que apresentaram defeito...">{{ diagnostico.pecas_defeito or '' }}</textarea>
                </div>

                <div class="form-group full-width">
                    <label for="relatorio_final">üìÑ Relat√≥rio Final</label>
                    <textarea id="relatorio_final" name="relatorio_final" class="form-control" 
                              placeholder="Descreva o diagn√≥stico completo, causas do problema e solu√ß√µes aplicadas..."
                              rows="6">{{ diagnostico.relatorio_final or '' }}</textarea>
                </div>

                <div class="form-group full-width">
                    <label for="observacoes">üí° Observa√ß√µes</label>
                    <textarea id="observacoes" name="observacoes" class="form-control" 
                              placeholder="Observa√ß√µes adicionais para a equipe..."
                              rows="3">{{ diagnostico.observacoes or '' }}</textarea>
                </div>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('admin_diagnosticos') }}" class="btn btn-warning">
                    ‚Ü©Ô∏è Voltar
                </a>
                <button type="submit" class="btn btn-primary">
                    üíæ Atualizar Diagn√≥stico
                </button>
                <a href="{{ url_for('api_relatorio_diagnostico', id_diagnostico=diagnostico.id_diagnostico) }}" 
                   target="_blank" class="btn btn-info">
                    üìÑ Gerar Relat√≥rio
                </a>
            </div>
        </form>
    </div>

    <!-- Informa√ß√µes do T√©cnico -->
    {% if diagnostico.tecnico_nome %}
    <div class="form-container">
        <h3 style="margin-bottom: 1rem; color: var(--primary);">üë®‚Äçüíº Respons√°vel pelo Diagn√≥stico</h3>
        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,102,255,0.05); border-radius: 8px;">
            <div style="font-size: 2rem;">üîß</div>
            <div>
                <strong>{{ diagnostico.tecnico_nome }}</strong>
                <div style="opacity: 0.7; font-size: 0.9rem;">
                    T√©cnico respons√°vel pela an√°lise
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.getElementById('status').addEventListener('change', function() {
    const status = this.value;
    const orcamentoField = document.getElementById('orcamento');
    const pecasField = document.getElementById('pecas_defeito');
    const relatorioField = document.getElementById('relatorio_final');
    
    // Mostrar campos relevantes baseado no status
    if (status === 'diagnosticado' || status === 'orcamento') {
        pecasField.placeholder = 'Liste as pe√ßas que apresentaram defeito... (Obrigat√≥rio)';
        relatorioField.placeholder = 'Descreva o diagn√≥stico completo... (Obrigat√≥rio)';
    } else if (status === 'concluido' || status === 'entregue') {
        relatorioField.placeholder = 'Descreva o servi√ßo realizado... (Obrigat√≥rio)';
    }
});
</script>
{% endblock %}