{% extends 'admin/base.html' %}

{% block title %}Combos - Admin{% endblock %}

{% block page_title %}üõí Gerenciar Combos{% endblock %}

{% block content %}
<div class="data-table">
    <div class="table-header">
        <h3>Lista de Combos</h3>
        <div class="table-actions">
            <a href="{{ url_for('admin_novo_combo') }}" class="btn btn-primary">
                ‚ûï Novo Combo
            </a>
        </div>
    </div>

    <div style="padding: 1.5rem 2rem; border-bottom: 1px solid var(--border); background: rgba(0,102,255,0.02);">
        <form method="GET" style="display: flex; gap: 1rem; align-items: end;">
            <div style="flex: 1;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem;">Buscar</label>
                <input type="text" name="busca" value="{{ request.args.get('busca', '') }}" 
                       class="form-control" placeholder="Nome do combo...">
            </div>
            <div style="width: 200px;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem;">Status</label>
                <select name="status" class="form-control">
                    <option value="">Todos</option>
                    <option value="ativo" {% if request.args.get('status') == 'ativo' %}selected{% endif %}>Ativo</option>
                    <option value="inativo" {% if request.args.get('status') == 'inativo' %}selected{% endif %}>Inativo</option>
                </select>
            </div>
            <div>
                <button type="submit" class="btn btn-primary">üîç Filtrar</button>
                <a href="{{ url_for('admin_listar_combos') }}" class="btn btn-warning">üîÑ Limpar</a>
            </div>
        </form>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Combo</th>
                <th>Pre√ßo</th>
                <th>Produtos</th>
                <th>Status</th>
                <th>Data</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for item in combos %}
            <tr>
                <td>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div>
                            <strong>{{ item.nome }}</strong>
                            {% if item.descricao %}
                            <br>
                            <small style="color: var(--text-light);">
                                {{ item.descricao[:100] }}{% if item.descricao|length > 100 %}...{% endif %}
                            </small>
                            {% endif %}
                        </div>
                    </div>
                </td>
                <td><strong>R$ {{ "%.2f"|format(item.preco) }}</strong></td>
                <td>
                    <span class="badge badge-primary">{{ item.total_produtos or 0 }}</span>
                </td>
                <td>
                    <span class="badge {% if item.ativo %}badge-success{% else %}badge-danger{% endif %}">
                        {{ 'Ativo' if item.ativo else 'Inativo' }}
                    </span>
                </td>
                <td style="color: var(--text-light);">
                    {% if item.data_criacao %}
                        {{ item.data_criacao.strftime('%d/%m/%Y') }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="{{ url_for('admin_editar_combo', id_combo=item.id_combo) }}" 
                           class="btn btn-sm btn-primary" title="Editar">
                            ‚úèÔ∏è
                        </a>
                        {% if item.ativo %}
                        <form method="POST" action="{{ url_for('admin_alternar_combo', id_combo=item.id_combo) }}" 
                              style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-warning" title="Desativar"
                                    onclick="return confirm('Desativar este combo?')">
                                üö´
                            </button>
                        </form>
                        {% else %}
                        <form method="POST" action="{{ url_for('admin_alternar_combo', id_combo=item.id_combo) }}" 
                              style="display: inline;">
                            <button type="submit" class="btn btn-sm btn-success" title="Ativar"
                                    onclick="return confirm('Ativar este combo?')">
                                ‚úÖ
                            </button>
                        </form>
                        {% endif %}
                        <form method="POST" action="{{ url_for('admin_excluir_combo', id_combo=item.id_combo) }}" 
                              style="display: inline;" 
                              onsubmit="return confirm('Tem certeza que deseja excluir este combo?');">
                            <button type="submit" class="btn btn-sm btn-danger" title="Excluir">
                                üóëÔ∏è
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 3rem;">
                    <div style="font-size: 1.2rem; margin-bottom: 1rem;">üì¶</div>
                    <h3>Nenhum combo encontrado</h3>
                    <p style="opacity: 0.7; margin-bottom: 1.5rem;">Comece criando seu primeiro combo</p>
                    <a href="{{ url_for('admin_novo_combo') }}" class="btn btn-primary">
                        ‚ûï Criar Primeiro Combo
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if combos %}
<div style="margin-top: 1.5rem; text-align: center; color: var(--dark); opacity: 0.7;">
    Mostrando <strong>{{ combos|length }}</strong> combo(s)
</div>
{% endif %}
{% endblock %}