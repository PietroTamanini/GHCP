{% extends "admin/base.html" %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}üìä Dashboard{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card">
        <h3>Total de Clientes</h3>
        <div class="value">{{ total_clientes }}</div>
        <div class="trend up">‚ÜóÔ∏è +12% este m√™s</div>
    </div>

    <div class="stat-card">
        <h3>Total de Produtos</h3>
        <div class="value">{{ total_produtos }}</div>
        <div class="trend up">‚ÜóÔ∏è +5% este m√™s</div>
    </div>

    <div class="stat-card">
        <h3>Pedidos Hoje</h3>
        <div class="value">{{ pedidos_hoje }}</div>
        <div class="trend up">‚ÜóÔ∏è Em andamento</div>
    </div>

    <div class="stat-card">
        <h3>Receita Hoje</h3>
        <div class="value">R$ {{ "%.2f"|format(receita_hoje) if receita_hoje is defined else "0.00" }}</div>
        <div class="trend up">‚ÜóÔ∏è +8% vs ontem</div>
    </div>

    <div class="stat-card">
        <h3>Diagn√≥sticos Pendentes</h3>
        <div class="value">{{ diagnosticos_pendentes }}</div>
        <div class="trend down">‚ÜòÔ∏è -3% esta semana</div>
    </div>

    <div class="stat-card">
        <h3>Taxa de Convers√£o</h3>
        <div class="value">2.8%</div>
        <div class="trend up">‚ÜóÔ∏è +0.4%</div>
    </div>
</div>

<div class="content-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 40px;">
    <!-- Estoque Baixo -->
    <div class="data-table">
        <div class="table-header">
            <h3>‚ö†Ô∏è Estoque Baixo</h3>
            <div class="table-actions">
                <a href="{{ url_for('admin_produtos') }}" class="btn btn-warning btn-sm">Gerenciar</a>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Estoque</th>
                    <th>Categoria</th>
                </tr>
            </thead>
            <tbody>
                {% if estoque_baixo %}
                    {% for produto in estoque_baixo %}
                    <tr>
                        <td>{{ produto.nome }}</td>
                        <td>
                            <span class="badge {% if produto.estoque <= 2 %}badge-danger{% else %}badge-warning{% endif %}">
                                {{ produto.estoque }} unidades
                            </span>
                        </td>
                        <td>{{ produto.categoria }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="3" style="text-align: center; color: var(--text-light); padding: 20px;">
                            ‚úÖ Nenhum produto com estoque baixo
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Pedidos Recentes -->
    <div class="data-table">
        <div class="table-header">
            <h3>üì¶ Pedidos Recentes</h3>
            <div class="table-actions">
                <a href="{{ url_for('admin_relatorios') }}" class="btn btn-primary btn-sm">Ver Todos</a>
            </div>
        </div>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Cliente</th>
                    <th>Total</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% if pedidos_recentes %}
                    {% for pedido in pedidos_recentes %}
                    <tr>
                        <td>#{{ pedido.id_pedido }}</td>
                        <td>{{ pedido.cliente_nome[:20] }}...</td>
                        <td>R$ {{ "%.2f"|format(pedido.total) }}</td>
                        <td>
                            <span class="badge badge-success">{{ pedido.status|title }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center; color: var(--text-light); padding: 20px;">
                            üìù Nenhum pedido recente
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Diagn√≥sticos Recentes -->
<div class="data-table">
    <div class="table-header">
        <h3>üîß Diagn√≥sticos Recentes</h3>
        <div class="table-actions">
            <a href="{{ url_for('admin_diagnosticos') }}" class="btn btn-info btn-sm">Ver Todos</a>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th>Equipamento</th>
                <th>Cliente</th>
                <th>Data</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% if diagnosticos_recentes %}
                {% for diagnostico in diagnosticos_recentes %}
                <tr>
                    <td>{{ diagnostico.tipo_equipamento }} - {{ diagnostico.marca }}</td>
                    <td>{{ diagnostico.nome_cliente }}</td>
                    <td>{{ diagnostico.data_entrada.strftime('%d/%m/%Y') }}</td>
                    <td>
                        <span class="badge 
                            {% if diagnostico.status == 'concluido' %}badge-success
                            {% elif diagnostico.status == 'em_analise' %}badge-warning
                            {% else %}badge-info{% endif %}">
                            {{ diagnostico.status|replace('_', ' ')|title }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="4" style="text-align: center; color: var(--text-light); padding: 20px;">
                        üîß Nenhum diagn√≥stico recente
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<style>
    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }

    @media (max-width: 968px) {
        .content-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}