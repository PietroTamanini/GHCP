{% extends "admin/base.html" %}

{% block title %}Editar Oferta{% endblock %}
{% block page_title %}üìù Editar Oferta{% endblock %}

{% block content %}
<div class="form-container">
    <form method="POST" enctype="multipart/form-data">
        <div class="form-grid">
            <div class="form-group full-width">
                <label for="id_produto">Produto *</label>
                <select name="id_produto" id="id_produto" class="form-control" required>
                    <option value="">Selecione um produto</option>
                    {% for produto in produtos %}
                    <option value="{{ produto.id_produto }}" 
                            {% if oferta.id_produto == produto.id_produto %}selected{% endif %}
                            data-preco="{{ produto.preco }}">
                        {{ produto.nome }} - R$ {{ "%.2f"|format(produto.preco) }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="desconto">Desconto (%) *</label>
                <input type="number" name="desconto" id="desconto" class="form-control" 
                       min="1" max="99" step="0.01" value="{{ oferta.desconto }}" required>
            </div>

            <div class="form-group">
                <label for="preco_original">Pre√ßo Original</label>
                <input type="text" id="preco_original" class="form-control" 
                       value="R$ {{ "%.2f"|format(oferta.preco_original) }}" readonly>
            </div>

            <div class="form-group">
                <label for="preco_com_desconto">Pre√ßo com Desconto</label>
                <input type="text" id="preco_com_desconto" class="form-control" 
                       value="R$ {{ "%.2f"|format(oferta.preco_com_desconto) }}" readonly>
            </div>

            <div class="form-group">
                <label for="validade">Validade *</label>
                <input type="date" name="validade" id="validade" class="form-control" 
                       value="{{ oferta.validade.strftime('%Y-%m-%d') if oferta.validade else '' }}" required>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="ativa" {% if oferta.ativa %}checked{% endif %}>
                    <span>Oferta ativa</span>
                </label>
            </div>
        </div>

        <div class="form-actions">
            <a href="{{ url_for('admin_ofertas') }}" class="btn btn-warning">
                ‚Ü©Ô∏è Cancelar
            </a>
            <button type="submit" class="btn btn-primary">
                üíæ Atualizar Oferta
            </button>
        </div>
    </form>
</div>

<style>
    .checkbox-label {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 12px 0;
    }

    .checkbox-label input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .preview-info {
        background: var(--secondary);
        padding: 16px;
        border-radius: 10px;
        margin-top: 16px;
        border-left: 4px solid var(--primary);
    }

    .preview-info h4 {
        margin-bottom: 8px;
        color: var(--primary);
    }

    .price-comparison {
        display: flex;
        gap: 20px;
        margin-top: 12px;
    }

    .old-price {
        text-decoration: line-through;
        color: var(--text-light);
        font-size: 16px;
    }

    .new-price {
        color: var(--success);
        font-size: 20px;
        font-weight: bold;
    }

    .discount-badge {
        background: var(--danger);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const produtoSelect = document.getElementById('id_produto');
        const descontoInput = document.getElementById('desconto');
        const precoOriginal = document.getElementById('preco_original');
        const precoComDesconto = document.getElementById('preco_com_desconto');

        function calcularPrecoComDesconto() {
            const produtoOption = produtoSelect.options[produtoSelect.selectedIndex];
            const precoBase = parseFloat(produtoOption.getAttribute('data-preco'));
            const desconto = parseFloat(descontoInput.value) || 0;

            if (precoBase && desconto > 0) {
                const precoFinal = precoBase - (precoBase * (desconto / 100));
                
                precoOriginal.value = `R$ ${precoBase.toFixed(2)}`;
                precoComDesconto.value = `R$ ${precoFinal.toFixed(2)}`;
            } else {
                precoOriginal.value = 'R$ 0,00';
                precoComDesconto.value = 'R$ 0,00';
            }
        }

        produtoSelect.addEventListener('change', calcularPrecoComDesconto);
        descontoInput.addEventListener('input', calcularPrecoComDesconto);

        // Calcular inicialmente
        calcularPrecoComDesconto();
    });
</script>
{% endblock %}