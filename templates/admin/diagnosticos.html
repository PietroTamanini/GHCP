{% extends "admin/base.html" %}

{% block title %}Diagn√≥sticos{% endblock %}
{% block page_title %}üîß Gerenciar Diagn√≥sticos{% endblock %}

{% block content %}
<div class="data-table">
    <div class="table-header">
        <h3>Solicita√ß√µes de Diagn√≥stico</h3>
        <div class="table-actions">
            <form method="GET" style="display: flex; gap: 1rem; align-items: center;">
                <select name="status" class="form-control" onchange="this.form.submit()">
                    <option value="">Todos os status</option>
                    <option value="recebido" {% if request.args.get('status') == 'recebido' %}selected{% endif %}>Recebido</option>
                    <option value="em_analise" {% if request.args.get('status') == 'em_analise' %}selected{% endif %}>Em An√°lise</option>
                    <option value="diagnosticado" {% if request.args.get('status') == 'diagnosticado' %}selected{% endif %}>Diagnosticado</option>
                    <option value="orcamento" {% if request.args.get('status') == 'orcamento' %}selected{% endif %}>Or√ßamento</option>
                    <option value="aprovado" {% if request.args.get('status') == 'aprovado' %}selected{% endif %}>Aprovado</option>
                    <option value="reparacao" {% if request.args.get('status') == 'reparacao' %}selected{% endif %}>Repara√ß√£o</option>
                    <option value="concluido" {% if request.args.get('status') == 'concluido' %}selected{% endif %}>Conclu√≠do</option>
                    <option value="entregue" {% if request.args.get('status') == 'entregue' %}selected{% endif %}>Entregue</option>
                </select>
                {% if request.args.get('status') %}
                <a href="{{ url_for('admin_diagnosticos') }}" class="btn btn-warning">üîÑ Limpar</a>
                {% endif %}
            </form>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Equipamento</th>
                <th>Problema</th>
                <th>Data</th>
                <th>T√©cnico</th>
                <th>Status</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for diagnostico in diagnosticos %}
            <tr>
                <td><strong>#{{ diagnostico.id_diagnostico }}</strong></td>
                <td>
                    <div>
                        <strong>{{ diagnostico.nome_cliente }}</strong>
                        <div style="font-size: 0.9rem; opacity: 0.7;">{{ diagnostico.email }}</div>
                        {% if diagnostico.telefone %}
                        <div style="font-size: 0.9rem; opacity: 0.7;">{{ diagnostico.telefone }}</div>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div>
                        <strong>{{ diagnostico.tipo_equipamento }}</strong>
                        {% if diagnostico.marca %}
                        <div style="font-size: 0.9rem; opacity: 0.7;">
                            {{ diagnostico.marca }} {{ diagnostico.modelo or '' }}
                        </div>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                        {{ diagnostico.problema }}
                    </div>
                </td>
                <td>{{ diagnostico.data_entrada.strftime('%d/%m/%Y') }}</td>
                <td>
                    {% if diagnostico.tecnico_nome %}
                    <span class="badge badge-info">{{ diagnostico.tecnico_nome }}</span>
                    {% else %}
                    <span style="opacity: 0.5;">N√£o atribu√≠do</span>
                    {% endif %}
                </td>
                <td>
                    <span class="badge 
                        {% if diagnostico.status == 'concluido' or diagnostico.status == 'entregue' %}badge-success
                        {% elif diagnostico.status == 'recebido' %}badge-warning
                        {% elif diagnostico.status == 'em_analise' or diagnostico.status == 'diagnosticado' %}badge-info
                        {% elif diagnostico.status == 'orcamento' or diagnostico.status == 'aprovado' or diagnostico.status == 'reparacao' %}badge-primary
                        {% else %}badge-secondary{% endif %}">
                        {{ diagnostico.status|replace('_', ' ')|title }}
                    </span>
                </td>
                <td>
                    <a href="{{ url_for('admin_detalhes_diagnostico', id_diagnostico=diagnostico.id_diagnostico) }}" 
                       class="btn btn-sm btn-primary">
                        üëÅÔ∏è Detalhes
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" style="text-align: center; padding: 3rem;">
                    <div style="font-size: 1.2rem; margin-bottom: 1rem;">üîß</div>
                    <h3>Nenhum diagn√≥stico encontrado</h3>
                    <p style="opacity: 0.7;">
                        {% if request.args.get('status') %}
                        Nenhum diagn√≥stico com status "{{ request.args.get('status')|replace('_', ' ')|title }}"
                        {% else %}
                        Ainda n√£o h√° solicita√ß√µes de diagn√≥stico
                        {% endif %}
                    </p>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if diagnosticos %}
<div style="margin-top: 1.5rem; text-align: center; color: var(--dark); opacity: 0.7;">
    Mostrando <strong>{{ diagnosticos|length }}</strong> diagn√≥stico(s)
    {% if request.args.get('status') %}com status "{{ request.args.get('status')|replace('_', ' ')|title }}"{% endif %}
</div>
{% endif %}

<!-- Legenda de Status -->
<div style="margin-top: 2rem; padding: 1.5rem; background: rgba(0,102,255,0.05); border-radius: 8px;">
    <h4 style="margin-bottom: 1rem; color: var(--primary);">üìã Legenda de Status</h4>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; font-size: 0.9rem;">
        <div>
            <span class="badge badge-warning" style="margin-right: 0.5rem;">Recebido</span>
            Solicita√ß√£o recebida
        </div>
        <div>
            <span class="badge badge-info" style="margin-right: 0.5rem;">Em An√°lise</span>
            Em an√°lise t√©cnica
        </div>
        <div>
            <span class="badge badge-info" style="margin-right: 0.5rem;">Diagnosticado</span>
            Problema identificado
        </div>
        <div>
            <span class="badge badge-primary" style="margin-right: 0.5rem;">Or√ßamento</span>
            Aguardando aprova√ß√£o
        </div>
        <div>
            <span class="badge badge-primary" style="margin-right: 0.5rem;">Aprovado</span>
            Or√ßamento aprovado
        </div>
        <div>
            <span class="badge badge-primary" style="margin-right: 0.5rem;">Repara√ß√£o</span>
            Em reparo
        </div>
        <div>
            <span class="badge badge-success" style="margin-right: 0.5rem;">Conclu√≠do</span>
            Reparo finalizado
        </div>
        <div>
            <span class="badge badge-success" style="margin-right: 0.5rem;">Entregue</span>
            Equipamento entregue
        </div>
    </div>
</div>
{% endblock %}