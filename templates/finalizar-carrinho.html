{% extends 'base.html' %}
{% set titulo = "Finalizar Compra" %}
{% block conteudo %}

<style>
.checkout-container {
    max-width: 700px;
    margin: 50px auto;
    background: var(--glass);
    padding: 40px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
}
.checkout-container h2 {
    text-align: center;
    font-size: 2.5em;
    font-weight: 800;
    color: var(--primary);
    margin-bottom: 30px;
}
.checkout-container form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.checkout-container label {
    font-weight: 600;
    color: var(--text);
}
.checkout-container input, 
.checkout-container select {
    padding: 10px;
    border-radius: 8px;
    border: 2px solid var(--border);
    background-color: var(--secondary);
    color: var(--text);
    font-weight: 600;
}
.checkout-container input:focus, 
.checkout-container select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(0, 102, 255, 0.2);
}
.btn-finalizar {
    background: linear-gradient(135deg, var(--success) 0%, #00b36e 100%);
    color: white;
    padding: 15px;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.2em;
    border: none;
    cursor: pointer;
    transition: var(--transition);
}
.btn-finalizar:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow);
}
.hidden {
    display: none;
}
</style>

<div class="checkout-container">
    <h2>ðŸ’³ Finalizar Compra</h2>
    <form method="POST" action="{{ url_for('finalizar_carrinho') }}">
        <label>Nome Completo</label>
        <input type="text" name="nome" required>

        <label>Email</label>
        <input type="email" name="email" required>

        <label>EndereÃ§o</label>
        <input type="text" name="endereco" required>

        <label>Forma de Pagamento</label>
        <select id="pagamento" name="pagamento" required>
            <option value="">Selecione</option>
            <option value="pix">PIX</option>
            <option value="cartao">CartÃ£o</option>
            <option value="boleto">Boleto</option>
        </select>

        <!-- Campos do CartÃ£o -->
        <div id="cartao-info" class="hidden">
            <label>Tipo de CartÃ£o</label>
            <select id="tipo-cartao" name="tipo_cartao">
                <option value="">Selecione</option>
                <option value="credito">CrÃ©dito</option>
                <option value="debito">DÃ©bito</option>
            </select>

            <div id="credito-info" class="hidden">
                <label>Parcelamento</label>
                <select id="parcelas" name="parcelas">
                    <option value="">Selecione</option>
                </select>
                <p id="valor-parcela" style="font-weight:600; color:var(--primary)"></p>
            </div>
        </div>

        <p>Total a Pagar: 
            <strong id="total">R$ {{ "%.2f"|format(total_geral) }}</strong>
        </p>
        <button type="submit" class="btn-finalizar">ðŸ’° Confirmar Compra</button>
    </form>
</div>

<script>
const pagamento = document.getElementById('pagamento');
const cartaoInfo = document.getElementById('cartao-info');
const tipoCartao = document.getElementById('tipo-cartao');
const creditoInfo = document.getElementById('credito-info');
const parcelasSelect = document.getElementById('parcelas');
const valorParcela = document.getElementById('valor-parcela');

const total = parseFloat("{{ total_geral }}");

pagamento.addEventListener('change', () => {
    cartaoInfo.classList.toggle('hidden', pagamento.value !== 'cartao');
});

tipoCartao.addEventListener('change', () => {
    creditoInfo.classList.toggle('hidden', tipoCartao.value !== 'credito');
    if (tipoCartao.value === 'credito') preencherParcelas();
});

function preencherParcelas() {
    parcelasSelect.innerHTML = '<option value="">Selecione</option>';
    for (let i = 1; i <= 6; i++) {
        parcelasSelect.innerHTML += `<option value="${i}">${i}x sem juros</option>`;
    }
    for (let i = 7; i <= 12; i++) {
        parcelasSelect.innerHTML += `<option value="${i}">${i}x com juros</option>`;
    }
}

parcelasSelect.addEventListener('change', () => {
    const parcelas = parseInt(parcelasSelect.value);
    let totalComJuros = total;
    if (parcelas > 6) {
        totalComJuros *= 1.05; // 5% de juros total (exemplo)
    }
    const valor = totalComJuros / parcelas;
    valorParcela.textContent = `Total: R$ ${totalComJuros.toFixed(2)} â€” ${parcelas}x de R$ ${valor.toFixed(2)}`;
});
</script>

{% endblock %}
