{% extends "base.html" %}

{% block conteudo %}
<div class="empresa-detalhes-container">
    <!-- Cabe√ßalho da Empresa -->
    <div class="empresa-header-section">
        <div class="empresa-header-content">
            <div class="empresa-logo-grande">
                <div class="logo-grande">{{ empresa.nome_fantasia[0] if empresa.nome_fantasia else empresa.razao_social[0] }}</div>
            </div>
            <div class="empresa-info-principal">
                <h1>{{ empresa.nome_fantasia or empresa.razao_social }}</h1>
                <div class="empresa-stats-header">
                    <div class="stat-header">
                        <span class="stat-value">{{ "%.1f"|format(media_avaliacoes.media_notas or 0) }}</span>
                        <span class="stat-label">Avalia√ß√£o</span>
                    </div>
                    <div class="stat-header">
                        <span class="stat-value">{{ media_avaliacoes.total_avaliacoes or 0 }}</span>
                        <span class="stat-label">Avalia√ß√µes</span>
                    </div>
                    <div class="stat-header">
                        <span class="stat-value">{{ produtos|length }}</span>
                        <span class="stat-label">Produtos</span>
                    </div>
                    <div class="stat-header">
                        <span class="stat-value">{{ empresa.tempo_mercado or "Novo" }}</span>
                        <span class="stat-label">No mercado</span>
                    </div>
                </div>
                <div class="empresa-actions">
                    {% if session.get('usuario_id') %}
                        <button class="btn-seguir" onclick="seguirEmpresa({{ empresa.id_empresa }})">
                            üìå Seguir Loja
                        </button>
                    {% endif %}
                    <button class="btn-compartilhar" onclick="compartilharEmpresa()">
                        üì§ Compartilhar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navega√ß√£o -->
    <div class="empresa-navigation">
        <nav class="nav-tabs">
            <a href="#produtos" class="nav-tab active" onclick="mudarAba('produtos')">üõçÔ∏è Produtos</a>
            <a href="#avaliacoes" class="nav-tab" onclick="mudarAba('avaliacoes')">‚≠ê Avalia√ß√µes</a>
            <a href="#sobre" class="nav-tab" onclick="mudarAba('sobre')">üìù Sobre</a>
            <a href="#contato" class="nav-tab" onclick="mudarAba('contato')">üìû Contato</a>
        </nav>
    </div>

    <!-- Conte√∫do das Abas -->
    <div class="empresa-content">
        <!-- ABA: PRODUTOS -->
        <div id="aba-produtos" class="aba-conteudo active">
            <div class="produtos-header">
                <h2>Produtos da Loja</h2>
                <div class="filtros-produtos">
                    <select onchange="filtrarProdutos(this.value)">
                        <option value="">Todos os produtos</option>
                        <option value="menor-preco">Menor pre√ßo</option>
                        <option value="maior-preco">Maior pre√ßo</option>
                        <option value="mais-vendidos">Mais vendidos</option>
                        <option value="novidades">Novidades</option>
                    </select>
                </div>
            </div>

            {% if produtos %}
            <div class="produtos-grid">
                {% for produto in produtos %}
                <div class="produto-card" onclick="verProduto({{ produto.id_produto }})">
                    <div class="produto-imagem">
                        {% if produto.imagens and produto.imagens is string %}
                            {% set imagens = produto.imagens|from_json %}
                            {% if imagens and imagens|length > 0 %}
                                <img src="{{ url_for('static', filename='uploads/produtos/' + imagens[0]) }}" alt="{{ produto.nome }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            {% endif %}
                        {% endif %}
                        <div class="produto-imagem-placeholder" style="{% if produto.imagens and produto.imagens is string and (produto.imagens|from_json)|length > 0 %}display: none;{% endif %}">
                            {{ produto.nome[0] if produto.nome else 'P' }}
                        </div>
                    </div>
                    <div class="produto-info">
                        <h3 class="produto-nome">{{ produto.nome }}</h3>
                        <p class="produto-marca">{{ produto.marca }}</p>
                        <div class="produto-preco">
                            <span class="preco-atual">R$ {{ "%.2f"|format(produto.preco_empresa or produto.preco) }}</span>
                            {% if produto.preco_original and produto.preco_original > (produto.preco_empresa or produto.preco) %}
                            <span class="preco-original">R$ {{ "%.2f"|format(produto.preco_original) }}</span>
                            {% endif %}
                        </div>
                        <div class="produto-estoque">
                            {% if produto.estoque_empresa and produto.estoque_empresa > 0 %}
                            <span class="estoque-disponivel">üü¢ {{ produto.estoque_empresa }} em estoque</span>
                            {% else %}
                            <span class="estoque-indisponivel">üî¥ Indispon√≠vel</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <i>üì¶</i>
                <h3>Nenhum produto encontrado</h3>
                <p>Esta loja ainda n√£o possui produtos cadastrados.</p>
            </div>
            {% endif %}
        </div>

        <!-- ABA: AVALIA√á√ïES -->
        <div id="aba-avaliacoes" class="aba-conteudo">
            <div class="avaliacoes-header">
                <h2>Avalia√ß√µes da Loja</h2>
                <div class="resumo-avaliacoes">
                    <div class="nota-geral">
                        <span class="nota-total">{{ "%.1f"|format(media_avaliacoes.media_notas or 0) }}</span>
                        <div class="estrelas-geral">
                            {% for i in range(5) %}
                                {% if i < (media_avaliacoes.media_notas or 0)|int %}
                                    ‚≠ê
                                {% else %}
                                    ‚≠ê
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="total-avaliacoes">{{ media_avaliacoes.total_avaliacoes or 0 }} avalia√ß√µes</span>
                    </div>
                </div>
            </div>

            <!-- Formul√°rio de Avalia√ß√£o -->
            {% if session.get('usuario_id') and pode_avaliar %}
            <div class="form-avaliacao-section">
                <h3>Deixe sua avalia√ß√£o</h3>
                <form class="form-avaliacao" onsubmit="enviarAvaliacaoEmpresa(event)">
                    <div class="avaliacao-nota">
                        <label>Sua nota:</label>
                        <div class="rating-input">
                            <input type="radio" id="avaliacao-star5" name="nota" value="5" required>
                            <label for="avaliacao-star5">‚≠ê</label>
                            <input type="radio" id="avaliacao-star4" name="nota" value="4">
                            <label for="avaliacao-star4">‚≠ê</label>
                            <input type="radio" id="avaliacao-star3" name="nota" value="3">
                            <label for="avaliacao-star3">‚≠ê</label>
                            <input type="radio" id="avaliacao-star2" name="nota" value="2">
                            <label for="avaliacao-star2">‚≠ê</label>
                            <input type="radio" id="avaliacao-star1" name="nota" value="1">
                            <label for="avaliacao-star1">‚≠ê</label>
                        </div>
                    </div>
                    <div class="avaliacao-comentario">
                        <label>Coment√°rio:</label>
                        <textarea name="comentario" placeholder="Conte sua experi√™ncia com esta loja..." required></textarea>
                    </div>
                    <button type="submit" class="btn-enviar-avaliacao">üì® Enviar Avalia√ß√£o</button>
                </form>
            </div>
            {% elif session.get('usuario_id') and not pode_avaliar %}
            <div class="avaliacao-info">
                <p>üí° <strong>Voc√™ precisa ter comprado desta loja para poder avali√°-la.</strong></p>
                <p>Fa√ßa uma compra e volte aqui para compartilhar sua experi√™ncia!</p>
            </div>
            {% else %}
            <div class="avaliacao-info">
                <p>üîê <strong>Fa√ßa login para avaliar esta loja.</strong></p>
                <p>Entre na sua conta para compartilhar sua experi√™ncia!</p>
            </div>
            {% endif %}

            <!-- Lista de Avalia√ß√µes -->
            <div class="lista-avaliacoes">
                {% if avaliacoes %}
                    {% for avaliacao in avaliacoes %}
                    <div class="avaliacao-item">
                        <div class="avaliacao-header">
                            <div class="avaliador-info">
                                <div class="avaliador-avatar">
                                    {{ avaliacao.avaliador_nome[0] if avaliacao.avaliador_nome else 'U' }}
                                </div>
                                <div>
                                    <strong>{{ avaliacao.avaliador_nome or 'Usu√°rio' }}</strong>
                                    <div class="avaliacao-estrelas">
                                        {{ '‚≠ê' * avaliacao.nota }}
                                    </div>
                                </div>
                            </div>
                            <span class="avaliacao-data">
                                {{ avaliacao.data_avaliacao.strftime('%d/%m/%Y') if avaliacao.data_avaliacao else '' }}
                            </span>
                        </div>
                        <p class="avaliacao-texto">{{ avaliacao.comentario }}</p>
                    </div>
                    {% endfor %}
                {% else %}
                <div class="empty-state">
                    <i>‚≠ê</i>
                    <h3>Nenhuma avalia√ß√£o ainda</h3>
                    <p>Seja o primeiro a avaliar esta loja!</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ABA: SOBRE -->
        <div id="aba-sobre" class="aba-conteudo">
            <div class="sobre-section">
                <h2>Sobre a Loja</h2>
                <div class="sobre-content">
                    <div class="sobre-info">
                        <div class="info-item">
                            <strong>Raz√£o Social:</strong>
                            <span>{{ empresa.razao_social }}</span>
                        </div>
                        <div class="info-item">
                            <strong>CNPJ:</strong>
                            <span>{{ empresa.cnpj }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Email:</strong>
                            <span>{{ empresa.email }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Telefone:</strong>
                            <span>{{ empresa.telefone or 'N√£o informado' }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Tipo:</strong>
                            <span>
                                {% if empresa.tipo_empresa == 'vendedor' %}
                                    Vendedor
                                {% elif empresa.tipo_empresa == 'comprador' %}
                                    Comprador
                                {% else %}
                                    Vendedor e Comprador
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <strong>Data de Cadastro:</strong>
                            <span>{{ empresa.data_cadastro.strftime('%d/%m/%Y') if empresa.data_cadastro else 'N√£o informada' }}</span>
                        </div>
                    </div>
                    
                    {% if empresa.endereco %}
                    <div class="endereco-section">
                        <h3>üìç Endere√ßo</h3>
                        <p>{{ empresa.endereco }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ABA: CONTATO -->
        <div id="aba-contato" class="aba-conteudo">
            <div class="contato-section">
                <h2>Entre em Contato</h2>
                <div class="contato-content">
                    <div class="contato-info">
                        <div class="contato-item">
                            <span class="contato-icon">üìß</span>
                            <div>
                                <strong>Email</strong>
                                <p>{{ empresa.email }}</p>
                            </div>
                        </div>
                        {% if empresa.telefone %}
                        <div class="contato-item">
                            <span class="contato-icon">üìû</span>
                            <div>
                                <strong>Telefone</strong>
                                <p>{{ empresa.telefone }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if session.get('usuario_id') %}
                    <div class="form-contato">
                        <h3>Enviar Mensagem</h3>
                        <form onsubmit="enviarMensagemContato(event)">
                            <div class="form-group">
                                <label>Assunto:</label>
                                <input type="text" name="assunto" placeholder="Assunto da mensagem..." required>
                            </div>
                            <div class="form-group">
                                <label>Mensagem:</label>
                                <textarea name="mensagem" rows="5" placeholder="Digite sua mensagem..." required></textarea>
                            </div>
                            <button type="submit" class="btn-enviar-mensagem">üì§ Enviar Mensagem</button>
                        </form>
                    </div>
                    {% else %}
                    <div class="contato-login">
                        <p>üîê <strong>Fa√ßa login para enviar uma mensagem para esta loja.</strong></p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .empresa-detalhes-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px 40px;
    }

    /* Header da Empresa */
    .empresa-header-section {
        background: var(--glass);
        border-radius: var(--radius);
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .empresa-header-content {
        display: flex;
        align-items: center;
        gap: 30px;
    }

    .empresa-logo-grande {
        flex-shrink: 0;
    }

    .logo-grande {
        width: 120px;
        height: 120px;
        border-radius: 24px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        font-weight: bold;
        color: white;
        box-shadow: var(--shadow-lg);
    }

    .empresa-info-principal {
        flex: 1;
    }

    .empresa-info-principal h1 {
        color: var(--text);
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 20px;
    }

    .empresa-stats-header {
        display: flex;
        gap: 40px;
        margin-bottom: 25px;
    }

    .stat-header {
        text-align: center;
    }

    .stat-header .stat-value {
        display: block;
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary);
    }

    .stat-header .stat-label {
        font-size: 0.9rem;
        color: var(--text-light);
        font-weight: 500;
    }

    .empresa-actions {
        display: flex;
        gap: 15px;
    }

    .btn-seguir, .btn-compartilhar {
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    .btn-seguir {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
    }

    .btn-compartilhar {
        background: var(--secondary);
        color: var(--text);
        border: 2px solid var(--border);
    }

    .btn-seguir:hover, .btn-compartilhar:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    /* Navega√ß√£o */
    .empresa-navigation {
        margin-bottom: 30px;
    }

    .nav-tabs {
        display: flex;
        gap: 0;
        background: var(--glass);
        border-radius: 12px;
        padding: 8px;
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .nav-tab {
        padding: 12px 24px;
        text-decoration: none;
        color: var(--text);
        font-weight: 600;
        border-radius: 8px;
        transition: var(--transition);
        flex: 1;
        text-align: center;
    }

    .nav-tab.active {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
    }

    .nav-tab:hover:not(.active) {
        background: var(--secondary);
    }

    /* Conte√∫do das Abas */
    .aba-conteudo {
        display: none;
    }

    .aba-conteudo.active {
        display: block;
    }

    /* Produtos */
    .produtos-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 30px;
    }

    .produtos-header h2 {
        color: var(--text);
        font-size: 1.8rem;
        font-weight: 700;
    }

    .filtros-produtos select {
        padding: 10px 16px;
        border: 2px solid var(--border);
        border-radius: 8px;
        background: var(--secondary);
        color: var(--text);
    }

    .produtos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .produto-card {
        background: var(--glass);
        border-radius: 16px;
        padding: 20px;
        cursor: pointer;
        transition: var(--transition);
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .produto-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-light);
    }

    .produto-imagem {
        width: 100%;
        height: 200px;
        border-radius: 12px;
        background: var(--secondary);
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
    }

    .produto-imagem img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .produto-imagem-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        color: var(--text-light);
        background: var(--secondary);
        border-radius: 12px;
    }

    .produto-info h3 {
        color: var(--text);
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 8px;
        line-height: 1.4;
    }

    .produto-marca {
        color: var(--text-light);
        font-size: 0.9rem;
        margin-bottom: 12px;
    }

    .produto-preco {
        margin-bottom: 10px;
    }

    .preco-atual {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary);
    }

    .preco-original {
        font-size: 0.9rem;
        color: var(--text-light);
        text-decoration: line-through;
        margin-left: 8px;
    }

    .produto-estoque {
        font-size: 0.8rem;
    }

    .estoque-disponivel {
        color: var(--success);
    }

    .estoque-indisponivel {
        color: var(--danger);
    }

    /* Avalia√ß√µes */
    .avaliacoes-header {
        display: flex;
        justify-content: between;
        align-items: start;
        margin-bottom: 30px;
    }

    .resumo-avaliacoes {
        background: var(--glass);
        padding: 25px;
        border-radius: 16px;
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .nota-geral {
        text-align: center;
    }

    .nota-total {
        display: block;
        font-size: 3rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 10px;
    }

    .estrelas-geral {
        font-size: 1.5rem;
        color: var(--warning);
        margin-bottom: 8px;
    }

    .total-avaliacoes {
        color: var(--text-light);
        font-size: 0.9rem;
    }

    .form-avaliacao-section {
        background: var(--glass);
        padding: 30px;
        border-radius: 16px;
        margin-bottom: 30px;
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .avaliacao-nota, .avaliacao-comentario {
        margin-bottom: 20px;
    }

    .avaliacao-nota label, .avaliacao-comentario label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text);
    }

    .rating-input {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
        gap: 5px;
    }

    .rating-input input {
        display: none;
    }

    .rating-input label {
        cursor: pointer;
        font-size: 2rem;
        transition: var(--transition);
        margin-bottom: 0;
    }

    .rating-input input:checked ~ label,
    .rating-input label:hover,
    .rating-input label:hover ~ label {
        color: var(--warning);
    }

    .avaliacao-comentario textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid var(--border);
        border-radius: 12px;
        background: var(--secondary);
        color: var(--text);
        font-family: inherit;
        resize: vertical;
    }

    .btn-enviar-avaliacao {
        background: linear-gradient(135deg, var(--success) 0%, #00b36e 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    .btn-enviar-avaliacao:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    .avaliacao-info {
        background: var(--glass);
        padding: 25px;
        border-radius: 16px;
        margin-bottom: 30px;
        text-align: center;
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .lista-avaliacoes {
        display: grid;
        gap: 20px;
    }

    .avaliacao-item {
        background: var(--glass);
        padding: 25px;
        border-radius: 16px;
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .avaliacao-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }

    .avaliador-info {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .avaliador-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.2rem;
    }

    .avaliacao-estrelas {
        color: var(--warning);
        font-size: 1.1rem;
    }

    .avaliacao-data {
        color: var(--text-light);
        font-size: 0.9rem;
    }

    .avaliacao-texto {
        color: var(--text);
        line-height: 1.6;
    }

    /* Sobre e Contato */
    .sobre-section, .contato-section {
        background: var(--glass);
        padding: 30px;
        border-radius: 16px;
        border: 1px solid var(--border);
        backdrop-filter: blur(20px);
    }

    .sobre-info {
        display: grid;
        gap: 15px;
    }

    .info-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--border);
    }

    .info-item:last-child {
        border-bottom: none;
    }

    .endereco-section {
        margin-top: 25px;
        padding-top: 25px;
        border-top: 2px solid var(--border);
    }

    .contato-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
    }

    .contato-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: var(--secondary);
        border-radius: 12px;
        margin-bottom: 15px;
    }

    .contato-icon {
        font-size: 1.5rem;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text);
    }

    .form-group input, .form-group textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border);
        border-radius: 12px;
        background: var(--secondary);
        color: var(--text);
        font-family: inherit;
    }

    .btn-enviar-mensagem {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    .btn-enviar-mensagem:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    .contato-login {
        text-align: center;
        padding: 40px;
        color: var(--text-light);
    }

    /* Estados Vazios */
    .empty-state {
        text-align: center;
        padding: 60px 40px;
        color: var(--text-light);
        background: var(--glass);
        border-radius: 16px;
        border: 2px dashed var(--border);
    }

    .empty-state i {
        font-size: 4rem;
        margin-bottom: 20px;
        display: block;
    }

    .empty-state h3 {
        color: var(--text);
        margin-bottom: 10px;
        font-size: 1.5rem;
    }

    @media (max-width: 968px) {
        .empresa-detalhes-container {
            padding: 20px;
        }
        
        .empresa-header-content {
            flex-direction: column;
            text-align: center;
        }
        
        .empresa-stats-header {
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .nav-tabs {
            flex-direction: column;
        }
        
        .produtos-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        }
        
        .contato-content {
            grid-template-columns: 1fr;
        }
        
        .avaliacoes-header {
            flex-direction: column;
            gap: 20px;
        }
    }

    @media (max-width: 480px) {
        .empresa-stats-header {
            gap: 15px;
        }
        
        .stat-header .stat-value {
            font-size: 1.5rem;
        }
        
        .produtos-grid {
            grid-template-columns: 1fr;
        }
        
        .empresa-actions {
            flex-direction: column;
        }
    }
</style>

<script>
    function mudarAba(aba) {
        // Esconder todas as abas
        document.querySelectorAll('.aba-conteudo').forEach(aba => {
            aba.classList.remove('active');
        });
        
        // Remover active de todas as tabs
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Mostrar aba selecionada
        document.getElementById(`aba-${aba}`).classList.add('active');
        
        // Ativar tab selecionada
        document.querySelector(`.nav-tab[href="#${aba}"]`).classList.add('active');
    }

    function verProduto(produtoId) {
        window.location.href = `/produto/${produtoId}`;
    }

    function filtrarProdutos(filtro) {
        // Em produ√ß√£o, faria uma requisi√ß√£o AJAX para filtrar
        console.log('Filtrando por:', filtro);
        // Por enquanto, apenas recarrega a p√°gina
        window.location.reload();
    }

    function seguirEmpresa(empresaId) {
        if (!{{ 'true' if session.get('usuario_id') else 'false' }}) {
            alert('üîê Fa√ßa login para seguir esta loja.');
            return;
        }
        
        fetch(`/seguir-empresa/${empresaId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ Agora voc√™ est√° seguindo esta loja!');
            } else {
                alert('‚ùå ' + data.error);
            }
        })
        .catch(error => {
            console.error('Erro ao seguir empresa:', error);
            alert('‚ùå Erro ao seguir loja. Tente novamente.');
        });
    }

    function compartilharEmpresa() {
        const url = window.location.href;
        navigator.clipboard.writeText(url)
            .then(() => alert('‚úÖ Link copiado para a √°rea de transfer√™ncia!'))
            .catch(() => {
                // Fallback para navegadores mais antigos
                const tempInput = document.createElement('input');
                tempInput.value = url;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                alert('‚úÖ Link copiado para a √°rea de transfer√™ncia!');
            });
    }

    function enviarAvaliacaoEmpresa(event) {
        event.preventDefault();
        
        const formData = new FormData(event.target);
        
        fetch(`/avaliar-empresa/{{ empresa.id_empresa }}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ Avalia√ß√£o enviada com sucesso!');
                event.target.reset();
                location.reload();
            } else {
                alert('‚ùå ' + data.error);
            }
        })
        .catch(error => {
            console.error('Erro ao enviar avalia√ß√£o:', error);
            alert('‚ùå Erro ao enviar avalia√ß√£o. Tente novamente.');
        });
    }

    function enviarMensagemContato(event) {
        event.preventDefault();
        
        const formData = new FormData(event.target);
        
        fetch(`/enviar-mensagem-empresa/{{ empresa.id_empresa }}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ Mensagem enviada com sucesso!');
                event.target.reset();
            } else {
                alert('‚ùå ' + data.error);
            }
        })
        .catch(error => {
            console.error('Erro ao enviar mensagem:', error);
            alert('‚ùå Erro ao enviar mensagem. Tente novamente.');
        });
    }

    // Inicializar a primeira aba
    document.addEventListener('DOMContentLoaded', () => {
        mudarAba('produtos');
    });
</script>
{% endblock %}
[file content end]